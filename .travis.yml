language: node_js
cache: npm
# before_install:
#   - bash ./infrastructure/travis/install-openshift.sh
#   - export PATH=$PATH:/tmp/openshift
# install:
#   - npm ci
jobs:
  include:
    - stage: test
      install:
        - npm ci
      script:
        - npm run lint
        - npm run unit
    - stage: build
      script:
        - docker login -u $DOCKER_USER -p $DOCKER_PASS
        - export REPO=jobtechswe/myskills-api
        - export TAG="latest"
        - docker build -f Dockerfile -t $REPO:$TAG .
        - docker push $REPO:$TAG
    - stage: deploy
      install:
        - bash ./infrastructure/travis/install-openshift.sh
        - export PATH=$PATH:/tmp/openshift
      script: bash infrastructure/travis/deploy.sh
stages:
  - test
  - name: build
    if: branch = master
  # - name: deploy
  #   if: branch = master
  - deploy
branches:
  except:
    - master
services:
  - docker
env:
  global:
    - secure: DOYKVqaObpLYa7iaEPykCuHdXeUw2pHnSZL/6fylLKHDsCoMfvFvW939ubEQebsaeU4HHLMVJ0FT6gpQCRRNnxkp+BPypQMUnkcV6OzAKXoM7OSoaq2RzbAXMQXvaF5Jd82j2d3j1Dx2DF0bGdv5KTxNaqL4hqW1u0z7FIpD7EiTazC2NzSVharpp074t5vsTBBor24GY2QXJ9449gILP0Qw8/JImybmBJ5TtINyREWC+xmTkmjYG+i8zdQxLRW1nKIiWnH82ZwrJtrWS6DI1O1ZOtcCnSlPhlSxVLYgvk76BZr3rNrdgRs7QQ9nAI0XOzc+ao5+3PBy+pGIBGF8CO98qvQfRbDI24BO3Da0F6Rn9IzHd9zX42xMk5DySBR2CrXgCzoHPb1mor+rM6qsBG8O5zo9+AcK1q3sllzHF3o9hHZKQHB5audvdUehp+I5ryv2EbkcUXquPGRgpSHsvTGrDRLQwM9Jkf65SQbbzN9TpCEu7iZy4ysq/LiRKb+ebppsPR/qNrTXH1IDxTnAeUzpnCxc02v7/DnadfD7dLL9qQ2ue2ksrDOlqk79QeGogNvj6dsUySvIqPYEIF3T52u1M7VElGRNjmzox+9d1XcYcwCnRo0djLyRCn9xwMD3KkZQFhsFLGzKeM2TAW4mmJmsn1Od9QnHRrw0kiwXzvk= # $DOCKER_EMAIL
    - secure: R2J3BUD6u6GIqQXBPBTujuQNvC2/4QlxHNtqpJ4mdZ4ZjqrimlAI8mIrgWGtFcYjphfz2peD0py0oThDa99TZMdnWMwFnc5Z36UOc6nU4g+GRWdyuDchjxs+TLZ4wvT8UhghvWZseM7HCI4ha2F4+kxReAEgp6pgN2ia0FOXM+RO6NFdNDkmkqpgJcf1WuqGwAUpn0diSPTFOtwTcLQO0AaPtWkT/rRkqGa+qN0E5EhPmyVFDkUB/O/v5q57XbCDKRhQoBGCgn3QW2GaarXfgLCoUvrUJGg0oi3oM8Gndmup4cRs5h9qKEpxbB9C+Zrerx7J3iClpkCPUc9o2YWPXon3QIBpJSN99txcengaq+zQW72wiuNjxgCDAiMtnBgGve4JJTJDIXNasCA/o3DmspnMnDwXl083HQeGtiK09wNeKpen5suI4AcopATA0jKqPvibNRWVJFiTHbteRk0ZfllTOi5AOu6ww+WhxjDfxupOsf06/VpjMjEF1UIDcM6OXtolF0adcwbT2uaE2uHs6dr9T9uo2TLjEcW4IsSR2ucwQdtRXIAz9AYNe0nQAg87/izC4Ecaqwy4yq/a6zT7Tgnc+/c7OVOtetlchome4EvuDkAbtlZMfx04MQAkJDkgR0Hip//fK1atCVZsIodYoXWQKJCfOwaBdPkuKwKMsmQ= # $DOCKER_USER
    - secure: Z9mtme8CKE5xJRNUUIDce3xPNq3tn+bWAweyGo6jOIoJpN8bj/jyU9QntI9OlINAnl4qjc3K/73EKeF+63BGgGTRGejU4gB52om1u/++LNF4//Fi82wnCpH7bAQMASwPeZ4h2GHxvDKYPIMRG16tx/O7w6G0XV4qGXZuQLy9GMPdvgvX7Z4LQayxnuoM6FSJHz5eEPO//6wTZe1bze4laO+BddCxeMd1OAAVzrOCasbEz2G42cTa5Pj23/WsrbtUcbFvK+W3YJQBxNxhcVD7V+gxiYYPrdW4YzB/W/ojRrQLeKZPXDQ8bwfEs3+eoCMPTRRRHYIXTyr4Up7Bn9YND7YYbW/PYBA2WtDAo2zW/f/uCTHTWmB7KtcxE6PZNWytLFgkec+5LsDgZMioUf6l7/iQ2pt2jZ9BaYX+seiUSEPkyHgPfHQwD969T4D+7Ejs3xRgbxlUT76Zgs6CaBQGrQaU1pxqp6NcDjyvCfO0kmSVwsyUJyB0vKbaq0PaH0An3sOJYOTyD0HS8LWIA0dMlbNcp8rzP9tGIDhYaPiqteWD0NxoYb8WKNntqNKw3b4cB9BiHTLnpwqlFkXWxlPHG0980lLS7HQa28qWf0W8ToyhSDrFhJbCD1whq7AtZkin6IuDdI6XDqwXE4E6r5K6/VIeqPo3WJE+T2q6fh6gzJ8= # $DOCKER_PASS
    - secure: eK6qw6sTGwa9iHSOkSFHISh1KfT12twMWL0YDNuv1CMoONXOe5EBeuVeW4htQY4GR8Pne2r3eUpOXaEGPuTne8EvVsn2U5JdNTDzkyuf9brY69h220PmhxAO8uPLaaqarWKR89rhMc6qhYrDB34nxdr71I3HKMenI+21AQ+wullsjtOFJKHZjyKktO/bg/q6QJzjkopnOj3Y6fjDRtl3gi2nwb76QR9mo8VCXHNwDddR1r2lMPFo8xUkP9s5FCtIAVzw6suq/00w15o9s+Fphe91WdzBPd1XVe5sSyIfXJnBrSXYIVGuM+mURgMru0vm6eRm9CJCjn8m48shKWAuThRBHP8oR7yKQUotqnEH0nY0LePPdMvpHDqga53x184IfS5lirhYHlKG5fOSWvTxp/PQ5wqAde/pl8suIxidVmbbSsymX3/mVZW9vJ8TfbjepS5rJbvqQ5b8gaf3xaWBBu1Q2KVRfodCu7e5zAzi6kD9RC/yia18dCqimsfF/7V70vJOyN/2NOlY4apOcsI70zd7DtJkitBXELcGri8TiSHP00Xj9gqbnk7VB/+1pvHp19TotZnH+6Lx8ZlxdQLKQzPoTKvONtZCZRFPzKq31Ia8XRZzSWFwb5m+8MLwituKlU2CmU2OVgkpoWmeebbrImsBdPZwXyetIzcw5pcPwsM= # $OPENSHIFT_URL
    - secure: gTNPryLhaBe/7/MhJ38arh4IK2CN0d8ITDQt89I91zx/wp9neSX0SIEQum/1SixhOcf2a/LA55QM6Mz1AMzWik9Ji9WOmHWWP5EwMFkpQkhfLVZT/FGdARt7N24yqQphEeLL1ZYlb+xvYA/RIuf54qNDRx1iwKQlSBcXXai0AtOkP5cRnPrMwreEHVtkWVL44qN3BXLscEHb891o8DbmRbIdQAyMdrMgqc6JOw2rvM8i1baOc3VC726v6XJB6nJX14TUhDrgJQ2WMx926XgOQnVam+xhcMJUc1gq5aOTnG91ivA5xAzNPL0Vx8VA6+N+wfxlH6d62KqmGoC5NtvmNLTjUi0TdR28VdV4iC368z9ArdNU5Yk1uuVM6bAqh/eW/aCakn/4FN5lrrtAovPpL90kZTgeu/ZTVZ+J7CmSdIJ3vcTZn27ERVTDm27+6JSO0+lTea8IdV/5EiDO99FjSMv4LM9nKzUXsq8yOwpJGIe8kA7aKwSy/tUETOY+RA5AWzYhhtj0cFbU1jyI81PR2ekfIxDQhEm6EPhNdow5CnN7MYI4aCVmUD+iHjLxKUT7Ihas7+Jt8kkFsNM0qRUlRpBO9utrva6pStiBvbQY6QzCpTZHmCML9yrQOHmQZx8ZSfvr7kDjfBnKosGWJtTaMioYb7q0veozWbDtYamWJvo= # $OPENSHIFT_USER
    - secure: h6aLR7+kjbKFXNZHa/K1iZ8oSdp9nD1maz+hRARJnAGcFPxYTgKsZ+wo8Xp6JsEbonDvY8XA2q8U1nAbgtdg77lr+g2c26OTSYGDEQ8Kcg4633llFPQb0+xsJSWYFpp8sDqdN08BGUmi6cqVWRr+jwsSeqbNEAIKviGkMjTazD/kqapRAK5BtwBT9tqLveCiMBHONeTG7o0LObrJx1y+HswDpF+TqbdqNvrodOBn1U9FZSW61qZXKTx5FmaVQzROLh8bSJIsMF+J+x3aCjXxRVcFK3GM6sVyHd8oK2T2nXScbS/QjiFWE5KJJ9OXIYW1p3d7DDlFvFB0R39Shdde6W3eJKaVsOXjbR+ZVu4T3sSinfPKgK+dBXWzFJq9jNDYXfvLMw72cj+PDkeZemMl+LieDg/UQueuI1CLzsl5AFGzjR5Q+WmK9zPKF4GVRyL3aL0HC3mRHWLRT3EIShdFgXMO3c5eFj4d0Ok+i/FC8SkHAEn9JJLJrUP7wwEYWroljfIqrbFBNfls/h33Gmmj6K81rtTdDUpNn71PRkaBXwQ6Q7RFTyU3M2kqUK3G30QE3vOIwj46DDbjnaPyGyLjZ3YPDOmdzW8AEtnP3XEKqIr9/fL6AxBAOINNQqZ/I2BtMjI6t67xYRbaAZlbsXtXGWh5zMSfP1MjtJoexdKNbzg= # $OPENSHIFT_PASS
# deploy:
#   - provider: script
#     script: bash infrastructure/travis/deploy.sh
#     on:
#       repo: JobtechSwe/myskills-api
#       branch: feat/travis
#   - provider: script
#     script: chmod +x infrastructure/travis/deploy.sh && bash infrastructure/travis/deploy.sh
#     on:
#       repo: JobtechSwe/myskills-api
#       branch: master
